<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Habit Tracker</title>

<script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<style>
body { font-family: Arial, sans-serif; padding:20px; }
nav button { margin-right:10px; }
.habit-row { display:grid; grid-template-columns: 120px 1fr 280px; gap:15px; padding:10px 0; border-bottom:1px solid #ddd; }
.progress-bar { height:14px; background:#eee; width:100%; position:relative; }
.progress-fill { height:100%; background:#4caf50; }
.goal-label { font-size:12px; margin-bottom:4px; }
.week-grid, .month-grid { display:grid; gap:5px; }
.week-grid { grid-template-columns: repeat(7, 1fr); }
.month-grid { grid-template-columns: repeat(10, 1fr); }
.box { height:20px; background:#ddd; }
.box.filled { background:#4caf50; }
.section { margin-top:20px; }
.hidden { display:none; }
</style>
</head>

<body>
<h1>Habit Tracker</h1>

<div id="auth"></div>

<nav>
  <button onclick="showTab('dashboard')">Dashboard</button>
  <button onclick="showTab('weekly')">Weekly Activity</button>
  <button onclick="showTab('monthly')">Monthly Activity</button>
  <button onclick="showTab('settings')">Settings</button>
</nav>

<div id="dashboard" class="section"></div>
<div id="weekly" class="section hidden"></div>
<div id="monthly" class="section hidden"></div>
<div id="settings" class="section hidden"></div>

<script>
/* ---------------- SUPABASE AUTH ONLY ---------------- */
const SUPABASE_URL = "https://drnkoftzavraufyjwjvx.supabase.co";
const SUPABASE_KEY = "sb_publishable_3ZM5ByDTEwo3GS8KCbNHtw_zi6ewd6b";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ---------------- FAKE DATA ---------------- */
const habits = [
  {
    name: "Read",
    goals: [
      { type:"daily", target:1, completed:0 },
      { type:"weekly", target:3, completed:2 },
      { type:"monthly", target:12, completed:6 }
    ]
  },
  {
    name: "Run",
    goals: [
      { type:"daily", target:1, completed:1 },
      { type:"weekly", target:2, completed:1 },
      { type:"monthly", target:8, completed:3 }
    ]
  }
];

/* ---------------- HELPERS ---------------- */
function percent(c,t){ return ((c/t)*100).toFixed(1); }

function showTab(tab){
  ["dashboard","weekly","monthly","settings"].forEach(id=>{
    document.getElementById(id).classList.add("hidden");
  });
  document.getElementById(tab).classList.remove("hidden");
}

/* ---------------- DASHBOARD ---------------- */
function renderDashboard(){
  const el = document.getElementById("dashboard");
  el.innerHTML = "<h2>Daily Habits</h2>";

  habits.forEach(h=>{
    const dailyGoals = h.goals.filter(g=>g.type==="daily");
    dailyGoals.forEach(g=>{
      el.innerHTML += `
      <div class="habit-row">
        <div>
          <input type="checkbox" onchange="toggleDaily('${h.name}')">
          <div>${h.name}</div>
        </div>
        <div>
          <textarea placeholder="Reflection..."></textarea>
        </div>
        <div>
          <div class="goal-label">Daily</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${percent(g.completed,g.target)}%"></div>
          </div>
          <div>${g.completed}/${g.target} (${percent(g.completed,g.target)}%)</div>
        </div>
      </div>`;
    });
  });
}

function toggleDaily(name){
  const habit = habits.find(h=>h.name===name);
  const goal = habit.goals.find(g=>g.type==="daily");
  goal.completed = goal.completed ? 0 : 1;
  renderDashboard();
}

/* ---------------- WEEKLY ---------------- */
function renderWeekly(){
  const el = document.getElementById("weekly");
  el.innerHTML = "<h2>Weekly Activity</h2>";

  habits.forEach(h=>{
    h.goals.filter(g=>g.type==="weekly").forEach(g=>{
      el.innerHTML += `
      <h4>${h.name}</h4>
      <div style="display:grid;grid-template-columns:1fr 200px;gap:15px;">
        <div class="week-grid">
          ${Array.from({length:7}).map((_,i)=>
            `<div class="box ${i<g.completed?'filled':''}"></div>`).join("")}
        </div>
        <div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${percent(g.completed,g.target)}%"></div>
          </div>
          <div>${g.completed}/${g.target} (${percent(g.completed,g.target)}%)</div>
        </div>
      </div>`;
    });
  });
}

/* ---------------- MONTHLY ---------------- */
function renderMonthly(){
  const el = document.getElementById("monthly");
  el.innerHTML = "<h2>Monthly Activity</h2>";

  habits.forEach(h=>{
    h.goals.filter(g=>g.type==="monthly").forEach(g=>{
      el.innerHTML += `
      <h4>${h.name}</h4>
      <div style="display:grid;grid-template-columns:1fr 200px;gap:15px;">
        <div class="month-grid">
          ${Array.from({length:30}).map((_,i)=>
            `<div class="box ${i<g.completed?'filled':''}"></div>`).join("")}
        </div>
        <div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:${percent(g.completed,g.target)}%"></div>
          </div>
          <div>${g.completed}/${g.target} (${percent(g.completed,g.target)}%)</div>
        </div>
      </div>`;
    });
  });
}

/* ---------------- SETTINGS ---------------- */
function renderSettings(){
  document.getElementById("settings").innerHTML = `
    <h2>Settings</h2>
    <button onclick="logout()">Log out</button>
  `;
}

/* ---------------- AUTH ---------------- */
async function login(){
  await supabaseClient.auth.signInWithOAuth({provider:"google"});
}

async function logout(){
  await supabaseClient.auth.signOut();
  location.reload();
}

supabaseClient.auth.onAuthStateChange((_e,session)=>{
  const auth = document.getElementById("auth");
  if(!session){
    auth.innerHTML = `<button onclick="login()">Sign in with Google</button>`;
  } else {
    auth.innerHTML = `<p>Signed in as ${session.user.email}</p>`;
    renderDashboard();
    renderWeekly();
    renderMonthly();
    renderSettings();
  }
});
</script>
</body>
</html>
